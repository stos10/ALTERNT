<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALTERNATIVO - Sistema de Pontua√ß√£o Jiu Jitsu</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // √çcones SVG
        const Play = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Pause = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const Upload = ({ size = 64 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const RotateCcw = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const AlertCircle = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const Brain = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"></path>
                <path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path>
            </svg>
        );

        const JiuJitsuAnalyzer = () => {
            const [videoFile, setVideoFile] = useState(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentTime, setCurrentTime] = useState(0);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [aiSuggestions, setAiSuggestions] = useState([]);
            const videoRef = useRef(null);
            const canvasRef = useRef(null);

            const [score, setScore] = useState({
                athleteA: { points: 0, advantages: 0, penalties: 0 },
                athleteB: { points: 0, advantages: 0, penalties: 0 }
            });

            const [events, setEvents] = useState([]);
            const [currentPosition, setCurrentPosition] = useState('Standing');

            const positions = {
                'Standing': { points: 0, color: '#9CA3AF' },
                'Guarda Fechada': { points: 0, color: '#3B82F6' },
                'Guarda Aberta': { points: 0, color: '#60A5FA' },
                'Meia Guarda': { points: 0, color: '#93C5FD' },
                'Passagem de Guarda': { points: 3, color: '#FBBF24' },
                'Cem Quilos (Side Control)': { points: 0, color: '#F59E0B' },
                'Joelho na Barriga': { points: 2, color: '#EF4444' },
                'Montada': { points: 4, color: '#DC2626' },
                'Pegada nas Costas': { points: 4, color: '#991B1B' },
                'Raspagem': { points: 2, color: '#10B981' },
                'Queda': { points: 2, color: '#059669' }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('video/')) {
                    const url = URL.createObjectURL(file);
                    setVideoFile(url);
                    setScore({
                        athleteA: { points: 0, advantages: 0, penalties: 0 },
                        athleteB: { points: 0, advantages: 0, penalties: 0 }
                    });
                    setEvents([]);
                    setCurrentPosition('Standing');
                    setAiSuggestions([]);
                }
            };

            const togglePlay = () => {
                if (videoRef.current) {
                    if (isPlaying) {
                        videoRef.current.pause();
                    } else {
                        videoRef.current.play();
                    }
                    setIsPlaying(!isPlaying);
                }
            };

            const resetAnalysis = () => {
                setScore({
                    athleteA: { points: 0, advantages: 0, penalties: 0 },
                    athleteB: { points: 0, advantages: 0, penalties: 0 }
                });
                setEvents([]);
                setCurrentPosition('Standing');
                setAiSuggestions([]);
                if (videoRef.current) {
                    videoRef.current.currentTime = 0;
                }
            };

            // Adicionar pontua√ß√£o
            const addEvent = (position, athlete) => {
                const pointValue = positions[position]?.points || 0;
                const timestamp = videoRef.current?.currentTime || 0;
                
                const newEvent = {
                    id: Date.now(),
                    time: timestamp,
                    position: position,
                    athlete: athlete,
                    points: pointValue,
                    type: 'points'
                };

                setEvents(prev => [...prev, newEvent]);
                setCurrentPosition(position);

                setScore(prev => ({
                    ...prev,
                    [athlete]: {
                        ...prev[athlete],
                        points: prev[athlete].points + pointValue
                    }
                }));
            };

            // NOVA FUN√á√ÉO: Adicionar vantagem
            const addAdvantage = (athlete) => {
                const timestamp = videoRef.current?.currentTime || 0;
                
                const newEvent = {
                    id: Date.now(),
                    time: timestamp,
                    position: 'Vantagem',
                    athlete: athlete,
                    points: 0,
                    type: 'advantage'
                };

                setEvents(prev => [...prev, newEvent]);

                setScore(prev => ({
                    ...prev,
                    [athlete]: {
                        ...prev[athlete],
                        advantages: prev[athlete].advantages + 1
                    }
                }));
            };

            // NOVA FUN√á√ÉO: An√°lise b√°sica com IA simulada
            const analyzeVideoFrame = async () => {
                if (!videoRef.current || isAnalyzing) return;

                setIsAnalyzing(true);

                // Captura frame do v√≠deo
                const canvas = canvasRef.current;
                const video = videoRef.current;
                const ctx = canvas.getContext('2d');
                
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0);

                // Simula an√°lise de IA (em produ√ß√£o, usaria Claude API ou TensorFlow)
                setTimeout(() => {
                    const possiblePositions = [
                        { position: 'Guarda Fechada', confidence: 0.85, athlete: 'B' },
                        { position: 'Controle de postura', confidence: 0.72, athlete: 'A' },
                        { position: 'Tentativa de raspagem', confidence: 0.65, athlete: 'B' }
                    ];

                    setAiSuggestions(possiblePositions);
                    setIsAnalyzing(false);
                }, 1500);
            };

            // Aceitar sugest√£o da IA
            const acceptAiSuggestion = (suggestion) => {
                if (suggestion.position in positions && positions[suggestion.position].points > 0) {
                    addEvent(suggestion.position, suggestion.athlete === 'A' ? 'athleteA' : 'athleteB');
                }
                setAiSuggestions([]);
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            useEffect(() => {
                const video = videoRef.current;
                if (video) {
                    const handleTimeUpdate = () => {
                        setCurrentTime(video.currentTime);
                    };
                    video.addEventListener('timeupdate', handleTimeUpdate);
                    return () => video.removeEventListener('timeupdate', handleTimeUpdate);
                }
            }, [videoFile]);

            return (
                <div className="min-h-screen bg-black text-white p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="text-center mb-6">
                            <h1 className="text-4xl font-bold mb-2 bg-gradient-to-r from-orange-600 to-orange-400 bg-clip-text text-transparent">
                                ALTERNATIVO
                            </h1>
                            <p className="text-gray-400">Sistema de pontua√ß√£o em tempo real com IA</p>
                        </div>

                        {!videoFile ? (
                            <div className="bg-gray-900 rounded-lg p-8 text-center border-2 border-dashed border-orange-800 mb-6">
                                <div className="flex justify-center mb-4 text-orange-600">
                                    <Upload size={64} />
                                </div>
                                <label className="cursor-pointer">
                                    <span className="bg-orange-700 hover:bg-orange-800 px-6 py-3 rounded-lg inline-block transition">
                                        Carregar V√≠deo de Luta
                                    </span>
                                    <input
                                        type="file"
                                        accept="video/*"
                                        onChange={handleFileUpload}
                                        className="hidden"
                                    />
                                </label>
                                <p className="text-gray-500 mt-4 text-sm">MP4, MOV, AVI aceitos</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div className="bg-gradient-to-br from-orange-700 to-orange-900 rounded-lg p-6">
                                        <div className="text-center">
                                            <h3 className="text-xl font-bold mb-2">Atleta A</h3>
                                            <div className="text-5xl font-bold mb-2">{score.athleteA.points}</div>
                                            <div className="flex justify-center gap-4 text-sm">
                                                <div>
                                                    <span className="text-gray-200">Vantagens:</span>
                                                    <span className="ml-2 font-bold">{score.athleteA.advantages}</span>
                                                </div>
                                                <div>
                                                    <span className="text-gray-200">Penalidades:</span>
                                                    <span className="ml-2 font-bold">{score.athleteA.penalties}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-gradient-to-br from-gray-800 to-black rounded-lg p-6 border border-orange-800">
                                        <div className="text-center">
                                            <h3 className="text-xl font-bold mb-2">Atleta B</h3>
                                            <div className="text-5xl font-bold mb-2">{score.athleteB.points}</div>
                                            <div className="flex justify-center gap-4 text-sm">
                                                <div>
                                                    <span className="text-gray-200">Vantagens:</span>
                                                    <span className="ml-2 font-bold">{score.athleteB.advantages}</span>
                                                </div>
                                                <div>
                                                    <span className="text-gray-200">Penalidades:</span>
                                                    <span className="ml-2 font-bold">{score.athleteB.penalties}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-gray-900 rounded-lg p-4 text-center border border-orange-800">
                                    <div className="text-sm text-gray-400 mb-1">Posi√ß√£o Atual</div>
                                    <div 
                                        className="text-2xl font-bold px-4 py-2 rounded inline-block"
                                        style={{ backgroundColor: positions[currentPosition]?.color }}
                                    >
                                        {currentPosition}
                                    </div>
                                </div>

                                <div className="bg-gray-900 rounded-lg overflow-hidden border border-orange-800">
                                    <video
                                        ref={videoRef}
                                        src={videoFile}
                                        className="w-full"
                                        onPlay={() => setIsPlaying(true)}
                                        onPause={() => setIsPlaying(false)}
                                    />
                                    <canvas ref={canvasRef} className="hidden" />
                                    
                                    <div className="p-4 bg-black">
                                        <div className="flex gap-2 mb-3">
                                            <button
                                                onClick={togglePlay}
                                                className="bg-orange-700 hover:bg-orange-800 p-3 rounded-lg transition flex-shrink-0"
                                            >
                                                {isPlaying ? <Pause /> : <Play />}
                                            </button>
                                            <button
                                                onClick={resetAnalysis}
                                                className="bg-gray-800 hover:bg-gray-900 p-3 rounded-lg transition flex-shrink-0 border border-orange-800"
                                            >
                                                <RotateCcw />
                                            </button>
                                            <button
                                                onClick={analyzeVideoFrame}
                                                disabled={isAnalyzing}
                                                className="bg-purple-700 hover:bg-purple-800 p-3 rounded-lg transition flex-shrink-0 disabled:opacity-50"
                                                title="Analisar frame com IA"
                                            >
                                                <Brain size={24} />
                                            </button>
                                            <div className="flex-1 bg-gray-900 rounded-lg px-4 flex items-center justify-center font-mono border border-orange-800">
                                                {formatTime(currentTime)}
                                            </div>
                                        </div>
                                        {isAnalyzing && (
                                            <div className="text-center text-purple-400 text-sm">
                                                üß† Analisando v√≠deo com IA...
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Sugest√µes da IA */}
                                {aiSuggestions.length > 0 && (
                                    <div className="bg-purple-900/30 border border-purple-700 rounded-lg p-4">
                                        <h3 className="text-lg font-bold mb-3 flex items-center gap-2">
                                            <Brain size={20} />
                                            Sugest√µes da IA
                                        </h3>
                                        <div className="space-y-2">
                                            {aiSuggestions.map((suggestion, idx) => (
                                                <div key={idx} className="bg-gray-900 p-3 rounded-lg flex justify-between items-center">
                                                    <div>
                                                        <span className="font-bold text-purple-400">
                                                            Atleta {suggestion.athlete}
                                                        </span>
                                                        <span className="mx-2">‚Ä¢</span>
                                                        <span>{suggestion.position}</span>
                                                        <span className="ml-2 text-sm text-gray-400">
                                                            ({Math.round(suggestion.confidence * 100)}% confian√ßa)
                                                        </span>
                                                    </div>
                                                    <button
                                                        onClick={() => acceptAiSuggestion(suggestion)}
                                                        className="bg-purple-700 hover:bg-purple-800 px-4 py-2 rounded text-sm transition"
                                                    >
                                                        Aceitar
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div className="bg-gray-900 rounded-lg p-4 border border-orange-800">
                                    <h3 className="text-lg font-bold mb-3 flex items-center gap-2">
                                        <AlertCircle size={20} />
                                        Adicionar Pontua√ß√£o Manual
                                    </h3>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <h4 className="text-sm font-bold text-orange-400 mb-2">Atleta A</h4>
                                            
                                            {/* BOT√ÉO DE VANTAGEM */}
                                            <button
                                                onClick={() => addAdvantage('athleteA')}
                                                className="w-full bg-yellow-600 hover:bg-yellow-700 px-3 py-2 rounded text-sm transition mb-2 font-bold"
                                            >
                                                ‚≠ê VANTAGEM
                                            </button>
                                            
                                            <div className="grid grid-cols-2 gap-2">
                                                {Object.keys(positions).filter(p => positions[p].points > 0).map(pos => (
                                                    <button
                                                        key={pos}
                                                        onClick={() => addEvent(pos, 'athleteA')}
                                                        className="bg-orange-700 hover:bg-orange-800 px-3 py-2 rounded text-sm transition"
                                                    >
                                                        {pos} (+{positions[pos].points})
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="text-sm font-bold text-gray-400 mb-2">Atleta B</h4>
                                            
                                            {/* BOT√ÉO DE VANTAGEM */}
                                            <button
                                                onClick={() => addAdvantage('athleteB')}
                                                className="w-full bg-yellow-600 hover:bg-yellow-700 px-3 py-2 rounded text-sm transition mb-2 font-bold"
                                            >
                                                ‚≠ê VANTAGEM
                                            </button>
                                            
                                            <div className="grid grid-cols-2 gap-2">
                                                {Object.keys(positions).filter(p => positions[p].points > 0).map(pos => (
                                                    <button
                                                        key={pos}
                                                        onClick={() => addEvent(pos, 'athleteB')}
                                                        className="bg-gray-800 hover:bg-gray-900 px-3 py-2 rounded text-sm transition border border-orange-800"
                                                    >
                                                        {pos} (+{positions[pos].points})
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {events.length > 0 && (
                                    <div className="bg-gray-900 rounded-lg p-4 border border-orange-800">
                                        <h3 className="text-lg font-bold mb-3">Hist√≥rico de Eventos</h3>
                                        <div className="space-y-2 max-h-64 overflow-y-auto">
                                            {events.slice().reverse().map((event) => (
                                                <div
                                                    key={event.id}
                                                    className={`p-3 rounded-lg border ${
                                                        event.athlete === 'athleteA' 
                                                            ? 'bg-orange-900/50 border-orange-700' 
                                                            : 'bg-gray-800 border-orange-800'
                                                    }`}
                                                >
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <span className="font-bold">
                                                                {event.athlete === 'athleteA' ? 'Atleta A' : 'Atleta B'}
                                                            </span>
                                                            <span className="mx-2">‚Ä¢</span>
                                                            <span>{event.position}</span>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="font-bold text-lg">
                                                                {event.type === 'advantage' ? '‚≠ê' : `+${event.points}`}
                                                            </div>
                                                            <div className="text-xs text-gray-400">{formatTime(event.time)}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div className="bg-gray-900 rounded-lg p-4 text-sm text-gray-400 border border-orange-800">
                                    <h4 className="font-bold text-white mb-2">Como usar:</h4>
                                    <ul className="space-y-1 list-disc list-inside">
                                        <li>Carregue um v√≠deo de luta de Jiu Jitsu</li>
                                        <li>Use os bot√µes para adicionar pontua√ß√µes e vantagens manualmente</li>
                                        <li>Clique no bot√£o üß† (c√©rebro) para an√°lise com IA do frame atual</li>
                                        <li>Aceite ou ignore as sugest√µes da IA</li>
                                        <li>O sistema registra automaticamente o tempo de cada evento</li>
                                    </ul>
                                    <div className="mt-3 p-3 bg-orange-900/30 border border-orange-700 rounded">
                                        <strong>Nota:</strong> A an√°lise por IA √© simulada nesta vers√£o. Para an√°lise real, seria necess√°rio integrar com APIs de vis√£o computacional (MediaPipe, YOLO, Claude Vision API).
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<JiuJitsuAnalyzer />);
    </script>
</body>
</html>
